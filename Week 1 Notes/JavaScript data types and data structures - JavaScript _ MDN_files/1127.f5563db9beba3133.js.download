export const __webpack_id__="1127";export const __webpack_ids__=["1127"];export const __webpack_modules__={82170:function(e,t,n){n.d(t,{Gh:()=>l,HT:()=>p,Kp:()=>o,NX:()=>u,OM:()=>c,T$:()=>d,Tg:()=>h,Tq:()=>i,Tv:()=>s,cp:()=>a,rZ:()=>r,zh:()=>g});let i=1,r="5.0.5",a="glean_ping_info",s="glean_client_info",o="c0ffeec0-ffee-c0ff-eec0-ffeec0ffeec0",l="https://incoming.telemetry.mozilla.org",c="deletion-request",d="events",u=5,g="#glean_reference_time",p="#glean_execution_counter",h=[p,g]},87164:function(e,t,n){n.d(t,{o:()=>Context});var i=n(38377);let r="core.Context";let Context=class Context{constructor(){this.initialized=!1,this.testing=!1,this.supportedMetrics={},this.startTime=new Date}static get instance(){return Context._instance||(Context._instance=new Context),Context._instance}static testUninitialize(){Context._instance=void 0}static get uploadEnabled(){return void 0===Context.instance.uploadEnabled&&(0,i.A)(r,["Attempted to access Context.uploadEnabled before it was set. This may cause unexpected behaviour."],i.q.Trace),Context.instance.uploadEnabled}static set uploadEnabled(e){Context.instance.uploadEnabled=e}static get metricsDatabase(){return void 0===Context.instance.metricsDatabase&&(0,i.A)(r,["Attempted to access Context.metricsDatabase before it was set. This may cause unexpected behaviour."],i.q.Trace),Context.instance.metricsDatabase}static set metricsDatabase(e){Context.instance.metricsDatabase=e}static get eventsDatabase(){return void 0===Context.instance.eventsDatabase&&(0,i.A)(r,["Attempted to access Context.eventsDatabase before it was set. This may cause unexpected behaviour."],i.q.Trace),Context.instance.eventsDatabase}static set eventsDatabase(e){Context.instance.eventsDatabase=e}static get pingsDatabase(){return void 0===Context.instance.pingsDatabase&&(0,i.A)(r,["Attempted to access Context.pingsDatabase before it was set. This may cause unexpected behaviour."],i.q.Trace),Context.instance.pingsDatabase}static set pingsDatabase(e){Context.instance.pingsDatabase=e}static get errorManager(){return void 0===Context.instance.errorManager&&(0,i.A)(r,["Attempted to access Context.errorManager before it was set. This may cause unexpected behaviour."],i.q.Trace),Context.instance.errorManager}static set errorManager(e){Context.instance.errorManager=e}static get applicationId(){return void 0===Context.instance.applicationId&&(0,i.A)(r,["Attempted to access Context.applicationId before it was set. This may cause unexpected behaviour."],i.q.Trace),Context.instance.applicationId}static set applicationId(e){Context.instance.applicationId=e}static get initialized(){return Context.instance.initialized}static set initialized(e){Context.instance.initialized=e}static get config(){return void 0===Context.instance.config&&(0,i.A)(r,["Attempted to access Context.config before it was set. This may cause unexpected behaviour."],i.q.Trace),Context.instance.config}static set config(e){Context.instance.config=e}static get startTime(){return Context.instance.startTime}static get testing(){return Context.instance.testing}static set testing(e){Context.instance.testing=e}static get corePings(){return Context.instance.corePings}static set corePings(e){Context.instance.corePings=e}static get coreMetrics(){return Context.instance.coreMetrics}static set coreMetrics(e){Context.instance.coreMetrics=e}static set platform(e){Context.instance.platform=e}static get platform(){return void 0===Context.instance.platform&&(0,i.A)(r,["Attempted to access Context.platform before it was set. This may cause unexpected behaviour."],i.q.Trace),Context.instance.platform}static isPlatformSet(){return!!Context.instance.platform}static getSupportedMetric(e){return Context.instance.supportedMetrics[e]}static addSupportedMetric(e,t){e in Context.instance.supportedMetrics||(Context.instance.supportedMetrics[e]=t)}}},49175:function(e,t,n){var i,r;n.d(t,{B:()=>i}),(r=i||(i={})).InvalidValue="invalid_value",r.InvalidLabel="invalid_label",r.InvalidState="invalid_state",r.InvalidOverflow="invalid_overflow",r.InvalidType="invalid_type"},92:function(e,t,n){n.d(t,{A:()=>p});var i,r=n(87164),a=n(78500),s=n(79187),o=n(82170),l=n(38377);let c="core.glean_metrics";var d=i||(i={});let u={pageLoad:new s.A({category:"glean",name:"page_load",sendInPings:[o.T$],lifetime:"ping",disabled:!1},["url","referrer","title"]),elementClick:new s.A({category:"glean",name:"element_click",sendInPings:[o.T$],lifetime:"ping",disabled:!1},["id","type","label"]),pageId:new a.Ay({category:"glean",name:"page_id",sendInPings:[o.T$],lifetime:"application",disabled:!1})};function g(e){if(!r.o.initialized)return void(0,l.A)(c,"Attempted to record element click event before Glean was initialized. This is a no-op.",l.q.Warn);u.elementClick.record(e)}d.pageLoad=function(e){var t,n,i;if(!r.o.initialized)return void(0,l.A)(c,"Attempted to record a page load event before Glean was initialized. This is a no-op.",l.q.Warn);u.pageId.generateAndSet(),u.pageLoad.record({url:null!=(t=null==e?void 0:e.url)?t:"undefined"!=typeof window?window.location.href:"URL_NOT_PROVIDED_OR_AVAILABLE",referrer:null!=(n=null==e?void 0:e.referrer)?n:"undefined"!=typeof document?document.referrer:"REFERRER_NOT_PROVIDED_OR_AVAILABLE",title:null!=(i=null==e?void 0:e.title)?i:"undefined"!=typeof document?document.title:"TITLE_NOT_PROVIDED_OR_AVAILABLE"})},d.handleClickEvent=function(e){let t=e.target.closest("[data-glean-id], [data-glean-type], [data-glean-label]");t&&g(function(e){let t=e.dataset;return{...t.gleanId&&{id:t.gleanId},...t.gleanType&&{type:t.gleanType},...t.gleanLabel&&{label:t.gleanLabel}}}(t))},d.recordElementClick=g;let p=i},38377:function(e,t,n){var i,r;function a(e,t,n=i.Debug){let r=`(Glean.${e})`;Array.isArray(t)?console[n](r,...t):console[n](r,t)}n.d(t,{A:()=>a,q:()=>i}),(r=i||(i={})).Debug="debug",r.Info="info",r.Warn="warn",r.Error="error",r.Trace="trace"},58574:function(e,t,n){n.d(t,{j:()=>RecordedEvent});var i=n(82170),r=n(83589),a=n(46705),s=n(93716);let RecordedEvent=class RecordedEvent extends a.JW{constructor(e){super(e)}static withTransformedExtras(e,t){let n=t(e.extra||{});return{category:e.category,name:e.name,timestamp:e.timestamp,extra:n&&Object.keys(n).length>0?n:void 0}}addExtra(e,t){this.inner.extra||(this.inner.extra={}),this.inner.extra[e]=t}withoutReservedExtras(){return RecordedEvent.withTransformedExtras(this.get(),e=>Object.keys(e).filter(e=>!i.Tg.includes(e)).reduce((t,n)=>(t[n]=e[n],t),{}))}validate(e){if(!(0,r.Gv)(e))return{type:a.iF.Error,errorMessage:`Expected Glean event object, got ${typeof e}`};let t="category"in e&&(0,r.Kg)(e.category),n="name"in e&&(0,r.Kg)(e.name);if(!t||!n)return{type:a.iF.Error,errorMessage:`Unexpected value for "category" or "name" in event object: ${JSON.stringify(e)}`};if(!("timestamp"in e&&(0,r.Fq)(e.timestamp)&&e.timestamp>=0))return{type:a.iF.Error,errorMessage:`Event timestamp must be a positive integer, got ${JSON.stringify(e)}`};if(e.extra){if(!(0,r.Gv)(e.extra))return{type:a.iF.Error,errorMessage:`Expected Glean extras object, got ${typeof e}`};for(let[t,n]of Object.entries(e.extra)){let e=(0,s.oI)(t);if(e.type===a.iF.Error)return e;if(!(0,r.Kg)(n)&&!(0,r.Et)(n)&&!(0,r.Lm)(n))return{type:a.iF.Error,errorMessage:`Unexpected value for extra key ${t}: ${JSON.stringify(n)}`}}}return{type:a.iF.Success}}payload(){return RecordedEvent.withTransformedExtras(this.withoutReservedExtras(),e=>Object.keys(e).reduce((t,n)=>(t[n]=e[n].toString(),t),{}))}}},36633:function(e,t,n){n.d(t,{v:()=>MetricType});var i=n(87164),r=n(83589),a=n(30040);let MetricType=class MetricType{constructor(e,t,n){n&&i.o.addSupportedMetric(e,n),this.type=e,this.name=t.name,this.category=t.category,this.sendInPings=t.sendInPings,this.lifetime=t.lifetime,this.disabled=t.disabled,this.dynamicLabel=t.dynamicLabel}baseIdentifier(){return this.category.length>0?`${this.category}.${this.name}`:this.name}identifier(){let e=this.baseIdentifier();return(0,r.b0)(this.dynamicLabel)?e:(0,a.cW)(this)}shouldRecord(e){return e&&!this.disabled}testGetNumRecordedErrors(e,t=this.sendInPings[0]){return(0,r.xU)("testGetNumRecordedErrors")?i.o.errorManager.testGetNumRecordedErrors(this,e,t):0}}},46705:function(e,t,n){n.d(t,{JW:()=>Metric,c1:()=>MetricValidationError,iF:()=>r});var i,r,a=n(87164),s=n(49175);(i=r||(r={}))[i.Success=0]="Success",i[i.Error=1]="Error";let MetricValidationError=class MetricValidationError extends Error{constructor(e,t=s.B.InvalidType){super(e),this.type=t,this.name="MetricValidationError"}recordError(e){a.o.errorManager.record(e,this.type,this.message)}};let Metric=class Metric{constructor(e){this.inner=this.validateOrThrow(e)}get(){return this.inner}set(e){this.inner=e}validateOrThrow(e){let t=this.validate(e);if(t.type===r.Error)throw new MetricValidationError(t.errorMessage,t.errorType);return e}}},79187:function(e,t,n){n.d(t,{A:()=>EventMetricType,C:()=>InternalEventMetricType});var i,r=n(58574),a=n(36633),s=n(83589),o=n(87164),l=n(49175),c=n(46705),d=function(e,t,n,i,r){if("m"===i)throw TypeError("Private method is not writable");if("a"===i&&!r)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},u=function(e,t,n,i){if("a"===n&&!i)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};let InternalEventMetricType=class InternalEventMetricType extends a.v{constructor(e,t){super("event",e),this.allowedExtraKeys=t}record(e,t=(0,s.bQ)()){if(!this.shouldRecord(o.o.uploadEnabled))return;let n=Date.now();try{let i=new r.j({category:this.category,name:this.name,timestamp:t,extra:e}),a={};if(e&&this.allowedExtraKeys)for(let[t,n]of Object.entries(e))if(this.allowedExtraKeys.includes(t))(0,s.Kg)(n)?a[t]=(0,s.Wl)(this,n,500):a[t]=n;else{o.o.errorManager.record(this,l.B.InvalidValue,`Invalid key index: ${t}`);continue}a.glean_timestamp=n.toString(),i.set({...i.get(),extra:a}),o.o.eventsDatabase.record(this,i)}catch(e){e instanceof c.c1&&e.recordError(this)}}testGetValue(e=this.sendInPings[0]){if((0,s.xU)("testGetValue","core.metrics.EventMetricType")){let t=o.o.eventsDatabase.getEvents(e,this);return t&&t.forEach(e=>{e.extra&&(delete e.extra.glean_timestamp,0==Object.keys(e.extra).length&&(e.extra=void 0))}),t}}};let EventMetricType=class EventMetricType{constructor(e,t){i.set(this,void 0),d(this,i,new InternalEventMetricType(e,t),"f")}record(e){u(this,i,"f").record(e)}testGetValue(e=u(this,i,"f").sendInPings[0]){return u(this,i,"f").testGetValue(e)}testGetNumRecordedErrors(e,t=u(this,i,"f").sendInPings[0]){return u(this,i,"f").testGetNumRecordedErrors(e,t)}};i=new WeakMap},30040:function(e,t,n){n.d(t,{Uh:()=>o,X3:()=>l,cW:()=>c,ot:()=>LabeledMetric});var i=n(46705),r=n(87164),a=n(49175);let LabeledMetric=class LabeledMetric extends i.JW{constructor(e){super(e)}validate(e){return{type:i.iF.Success}}payload(){return this.inner}};let s=/^[a-z_][a-z0-9_-]{0,29}(\.[a-z_][a-z0-9_-]{0,29})*$/;function o(e,t){return`${e}/${t}`}function l(e){return e.split("/")[0]}function c(e){if(void 0===e.dynamicLabel)throw Error("This point should never be reached.");let t=o(e.baseIdentifier(),e.dynamicLabel);for(let n of e.sendInPings)if(r.o.metricsDatabase.hasMetric(e.lifetime,n,e.type,t))return t;let n=0;for(let t of e.sendInPings)n+=r.o.metricsDatabase.countByBaseIdentifier(e.lifetime,t,e.type,e.baseIdentifier());let i=!1;return n>=16?i=!0:e.dynamicLabel.length>61?(i=!0,r.o.errorManager.record(e,a.B.InvalidLabel,`Label length ${e.dynamicLabel.length} exceeds maximum of 61.`)):s.test(e.dynamicLabel)||(i=!0,r.o.errorManager.record(e,a.B.InvalidLabel,`Label must be snake_case, got '${e.dynamicLabel}'.`)),i?o(e.baseIdentifier(),"__other__"):t}},78500:function(e,t,n){n.d(t,{Ay:()=>p,Pc:()=>InternalUUIDMetricType});var i,r=n(36633),a=n(83589),s=n(87164),o=n(46705),l=n(49175),c=n(93716),d=function(e,t,n,i,r){if("m"===i)throw TypeError("Private method is not writable");if("a"===i&&!r)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},u=function(e,t,n,i){if("a"===n&&!i)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};let g=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;let UUIDMetric=class UUIDMetric extends o.JW{constructor(e){super(e)}validate(e){let t=(0,c.oI)(e);return t.type===o.iF.Error?t:g.test(e)?{type:o.iF.Success}:{type:o.iF.Error,errorMessage:`"${e}" is not a valid UUID`,errorType:l.B.InvalidValue}}payload(){return this.inner}};let InternalUUIDMetricType=class InternalUUIDMetricType extends r.v{constructor(e){super("uuid",e,UUIDMetric)}set(e){let t;if(this.shouldRecord(s.o.uploadEnabled)){e||(e=(0,a.Z3)());try{t=new UUIDMetric(e),s.o.metricsDatabase.record(this,t)}catch(e){e instanceof o.c1&&e.recordError(this)}}}generateAndSet(){if(!this.shouldRecord(s.o.uploadEnabled))return;let e=(0,a.Z3)();return this.set(e),e}testGetValue(e=this.sendInPings[0]){if((0,a.xU)("testGetValue","core.metrics.UUIDMetricType"))return s.o.metricsDatabase.getMetric(e,this)}};let p=class{constructor(e){i.set(this,void 0),d(this,i,new InternalUUIDMetricType(e),"f")}set(e){u(this,i,"f").set(e)}generateAndSet(){return u(this,i,"f").generateAndSet()}testGetValue(e=u(this,i,"f").sendInPings[0]){return u(this,i,"f").testGetValue(e)}testGetNumRecordedErrors(e,t=u(this,i,"f").sendInPings[0]){return u(this,i,"f").testGetNumRecordedErrors(e,t)}};i=new WeakMap},93716:function(e,t,n){n.d(t,{Hp:()=>c,LE:()=>d,oI:()=>g,wQ:()=>u});var i=n(46705),r=n(83589),a=n(30040),s=n(87164),o=n(49175),l=n(38377);function c(e,t){e.startsWith("labeled_")&&s.o.addSupportedMetric(e,a.ot);let n=s.o.getSupportedMetric(e);if(!n)throw Error(`Unable to create metric of unknown type "${e}".`);return new n(t)}function d(e,t){try{return c(e,t),!0}catch(e){return(0,l.A)("Glean.core.Metrics.utils",e.message,l.q.Error),!1}}function u(e,t=!0){return(0,r.Fq)(e)?(t?e<0:e<=0)?{type:i.iF.Error,errorMessage:`Expected positive value, got ${JSON.stringify(e)}`,errorType:o.B.InvalidValue}:{type:i.iF.Success}:{type:i.iF.Error,errorMessage:`Expected integer value, got ${JSON.stringify(e)}`}}function g(e){return(0,r.Kg)(e)?{type:i.iF.Success}:{type:i.iF.Error,errorMessage:`Expected string value, got ${JSON.stringify(e)}`}}},83589:function(e,t,n){let i;n.d(t,{b0:()=>p,zn:()=>v,cE:()=>D,Z3:()=>I,Fq:()=>b,bQ:()=>E,Et:()=>m,Gv:()=>g,IB:()=>M,xU:()=>T,Kg:()=>h,PK:()=>y,Lm:()=>f,qU:()=>w,EJ:()=>function e(t){if(h(t)||f(t)||m(t))return!0;if(g(t)){if(0===Object.keys(t).length)return!0;for(let n in t)return e(t[n])}return!!Array.isArray(t)&&t.every(t=>e(t))},Wl:()=>x,IY:()=>S});let r="undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),a=new Uint8Array(16),s=[];for(let e=0;e<256;++e)s.push((e+256).toString(16).slice(1));let o=function(e,t,n){if(r&&!t&&!e)return r();let o=(e=e||{}).random||(e.rng||function(){if(!i&&!(i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(a)})();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=o[e];return t}return function(e,t=0){return s[e[t+0]]+s[e[t+1]]+s[e[t+2]]+s[e[t+3]]+"-"+s[e[t+4]]+s[e[t+5]]+"-"+s[e[t+6]]+s[e[t+7]]+"-"+s[e[t+8]]+s[e[t+9]]+"-"+s[e[t+10]]+s[e[t+11]]+s[e[t+12]]+s[e[t+13]]+s[e[t+14]]+s[e[t+15]]}(o)};var l=n(87164),c=n(49175),d=n(38377),u=n(46705);function g(e){return"object"==typeof e&&null!==e&&e.constructor===Object}function p(e){return void 0===e}function h(e){return"string"==typeof e}function f(e){return"boolean"==typeof e}function m(e){return"number"==typeof e&&!isNaN(e)}function b(e){return m(e)&&Number.isInteger(e)}function y(e){return"true"===e.toLowerCase()||"false"!==e.toLowerCase()&&void 0}function v(e){return e.replace(/[^a-z0-9]+/gi,"-").toLowerCase()}function w(e){return/^(http|https):\/\/[a-zA-Z0-9._-]+(:\d+){0,1}(\/{0,1})$/i.test(e)}function S(e){return/^[a-z0-9-]{1,20}$/i.test(e)}function I(){return"undefined"!=typeof crypto?o():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}function E(){return Math.round("undefined"==typeof performance?Date.now():performance.now())}function x(e,t,n){if(!h(t))throw new u.c1(`Expected string, got ${JSON.stringify(t)}`);let i=new TextEncoder,r=new TextDecoder("utf-8"),a=i.encode(t).slice(0,n),s=r.decode(a);return s!==t&&l.o.errorManager.record(e,c.B.InvalidOverflow,`Value length ${new Blob([t]).size} exceeds maximum of ${t.length} bytes.`),s}function T(e,t="core.utils"){return!!l.o.testing||((0,d.A)(t,[`Attempted to access test only method \`${e||"unknown"}\`,`,"but Glean is not in testing mode. Ignoring. Make sure to put Glean in testing mode","before accessing such methods, by calling `testResetGlean`."],d.q.Error),!1)}function D(...e){let t=e.reduce((e,t)=>e+t,0);return t>Number.MAX_SAFE_INTEGER&&(t=Number.MAX_SAFE_INTEGER),t}function M(){return"undefined"==typeof window}},32890:function(e,t,n){let i;n.d(t,{Ay:()=>eo});var r,a,s,o,l,c,d,u,g,p,h,f=n(38377);(r=c||(c={}))[r.RecoverableFailure=0]="RecoverableFailure",r[r.UnrecoverableFailure=1]="UnrecoverableFailure",r[r.Success=2]="Success";let UploadResult=class UploadResult{constructor(e,t){this.result=e,this.status=t}};let Uploader=class Uploader{};let m=Uploader,b="platform.browser.FetchUploader";let BrowserFetchUploader=class BrowserFetchUploader extends m{constructor(){super(...arguments),this.timeoutMs=1e4}async post(e,t,n=!0){let i,r=new AbortController,a=setTimeout(()=>r.abort(),this.timeoutMs),s=t.asCompressedPayload();try{i=await fetch(e.toString(),{headers:s.headers,method:"POST",body:s.payload,keepalive:n,credentials:"omit",signal:r.signal,redirect:"error"})}catch(t){if(t instanceof DOMException)(0,f.A)(b,["Timeout while attempting to upload ping.\n",t],f.q.Error);else if(t instanceof TypeError){if(n)return this.post(e,s,!1);(0,f.A)(b,["Network error while attempting to upload ping.\n",t],f.q.Error)}else(0,f.A)(b,["Unknown error while attempting to upload ping.\n",t],f.q.Error);return clearTimeout(a),new UploadResult(0)}return clearTimeout(a),new UploadResult(2,i.status)}supportsCustomHeaders(){return!0}};let y=new BrowserFetchUploader;let BrowserSendBeaconUploader=class BrowserSendBeaconUploader extends m{constructor(){super(...arguments),this.timeoutMs=1e4}async post(e,t,n=!0){return navigator.sendBeacon(e,t.payload)?new UploadResult(2,200):(n&&(0,f.A)("platform.browser.SendBeaconUploader","The `sendBeacon` call was not serviced by the browser. Deleting data.",f.q.Error),new UploadResult(1))}supportsCustomHeaders(){return!1}};let v=new BrowserSendBeaconUploader;var w=n(87164);let S="platform.browser.SendBeaconFallbackUploader";let BrowserSendBeaconFallbackUploader=class BrowserSendBeaconFallbackUploader extends m{constructor(){super(...arguments),this.fetchUploader=y,this.sendBeaconUploader=v}async post(e,t){var n,i;if(!(null==(n=w.o.config)?void 0:n.sourceTags)&&!(null==(i=w.o.config)?void 0:i.debugViewTag)&&navigator&&navigator.sendBeacon){let n=await this.sendBeaconUploader.post(e,t,!1);if(2==n.result)return n;(0,f.A)(S,"The `sendBeacon` call was not serviced by the browser. Falling back to the `fetch` uploader.",f.q.Warn)}else(0,f.A)(S,"`sendBeacon` is not available. Falling back to the `fetch` uploader.",f.q.Warn);return this.fetchUploader.post(e,t)}supportsCustomHeaders(){return!1}};let I=new BrowserSendBeaconFallbackUploader;var E=n(83589);let x="platform.web.Storage";let WebStore=class WebStore{constructor(e){this.rootKey=e,this.logTag=`${x}.${e}`}get(e=[]){let t;if(!(0,E.IB)()){try{let n=localStorage.getItem(this.rootKey)||"{}",i=JSON.parse(n);t=e.length>0?function(e,t){if(0===t.length)throw Error("The index must contain at least one property to get.");let n=e;for(let e of t)if(!(0,E.Gv)(n)||!(e in n))return;else{let t=n[e];(0,E.EJ)(t)&&(n=t)}return n}(i,e):0===Object.keys(i).length?void 0:i}catch(e){(0,f.A)(x,["Unable to fetch value from local storage.",e],f.q.Error)}return this.shouldUpdateSession(e)&&w.o.coreMetrics.updateSessionInfo(),t}}update(e,t){if(!(0,E.IB)()){try{let n=localStorage.getItem(this.rootKey)||"{}",i=JSON.parse(n),r=function(e,t,n){if(0===t.length)throw Error("The index must contain at least one property to update.");let i={...e},r=i;for(let e of t.slice(0,t.length-1))(0,E.Gv)(r[e])||(r[e]={}),r=r[e];let a=t[t.length-1],s=n(r[a]);return r[a]=s,i}(i,e,t);localStorage.setItem(this.rootKey,JSON.stringify(r))}catch(e){(0,f.A)(x,["Unable to update value from local storage.",e],f.q.Error)}this.shouldUpdateSession(e)&&w.o.coreMetrics.updateSessionInfo()}}delete(e){if(!(0,E.IB)()){try{let t=localStorage.getItem(this.rootKey)||"{}",n=JSON.parse(t);if(0===e.length)localStorage.removeItem(this.rootKey);else try{let t=function(e,t){if(0===t.length)return{};let n={...e},i=n;for(let e of t.slice(0,t.length-1)){let n=i[e];if((0,E.Gv)(n))i=n;else throw Error(`Attempted to delete an entry from an inexistent index: ${JSON.stringify(t)}.`)}let r=t[t.length-1];return delete i[r],n}(n,e);localStorage.setItem(this.rootKey,JSON.stringify(t))}catch(t){(0,f.A)(this.logTag,[`Error attempting to delete key ${e.toString()} from storage. Ignoring.`,t],f.q.Warn)}}catch(e){(0,f.A)(x,["Unable to delete value from storage.",e],f.q.Error)}this.shouldUpdateSession(e)&&w.o.coreMetrics.updateSessionInfo()}}shouldUpdateSession(e){return!e.includes("session_id")&&!e.includes("session_count")}};var T=n(82170);let D="core.Config";let Configuration=class Configuration{constructor(e){var t;if(this.channel=null==e?void 0:e.channel,this.appBuild=null==e?void 0:e.appBuild,this.appDisplayVersion=null==e?void 0:e.appDisplayVersion,this.buildDate=null==e?void 0:e.buildDate,this.maxEvents=(null==e?void 0:e.maxEvents)||1,this.enableAutoPageLoadEvents=null==e?void 0:e.enableAutoPageLoadEvents,this.enableAutoElementClickEvents=null==e?void 0:e.enableAutoElementClickEvents,this.experimentationId=null==e?void 0:e.experimentationId,this.sessionLengthInMinutesOverride=null==e?void 0:e.sessionLengthInMinutesOverride,this.debug={},(null==e?void 0:e.serverEndpoint)&&!(0,E.qU)(e.serverEndpoint))throw Error(`Unable to initialize Glean, serverEndpoint ${e.serverEndpoint} is an invalid URL.`);if(!w.o.testing&&(null==(t=null==e?void 0:e.serverEndpoint)?void 0:t.startsWith("http:")))throw Error(`Unable to initialize Glean, serverEndpoint ${e.serverEndpoint} must use the HTTPS protocol.`);this.serverEndpoint=e&&e.serverEndpoint?e.serverEndpoint:T.Gh,this.httpClient=null==e?void 0:e.httpClient}get logPings(){return this.debug.logPings||!1}set logPings(e){this.debug.logPings=e}get debugViewTag(){return this.debug.debugViewTag}set debugViewTag(e){if(!(0,E.IY)(e||""))return void(0,f.A)(D,[`"${e||""}" is not a valid \`debugViewTag\` value.`,"Please make sure the value passed satisfies the regex `^[a-zA-Z0-9-]{1,20}$`."],f.q.Error);this.debug.debugViewTag=e}get sourceTags(){return this.debug.sourceTags}set sourceTags(e){if(!e||e.length<1||e.length>T.NX)return void(0,f.A)(D,`A list of tags cannot contain more than ${T.NX} elements or less than one.`,f.q.Error);for(let t of e){if(t.startsWith("glean"))return void(0,f.A)(D,"Tags starting with `glean` are reserved and must not be used.",f.q.Error);if(!(0,E.IY)(t))return}this.debug.sourceTags=e}};var M=n(69861);let P="core.Pings.Database";let PingsDatabase=class PingsDatabase{constructor(){this.store=new w.o.platform.Storage("pings")}attachObserver(e){this.observer=e}recordPing(e,t,n,i){let r={collectionDate:new Date().toISOString(),path:e,payload:n};i&&(r.headers=i),this.store.update([t],()=>r),this.observer&&this.observer.update(t,r)}deletePing(e){this.store.delete([e])}getAllPings(){let e=this.store.get(),t={};if((0,E.Gv)(e))for(let n in e){let i=e[n];!function(e){if((0,E.Gv)(e)){let t="collectionDate"in e&&(0,E.Kg)(e.collectionDate)&&(0,E.Et)(new Date(e.collectionDate).getTime()),n="path"in e&&(0,E.Kg)(e.path),i="payload"in e&&(0,E.EJ)(e.payload)&&(0,E.Gv)(e.payload),r=!("headers"in e)||(0,E.EJ)(e.headers)&&(0,E.Gv)(e.headers);return!!t&&!!n&&!!i&&!!r}return!1}(i)?((0,f.A)(P,`Unexpected data found in pings database: ${JSON.stringify(i,null,2)}. Deleting.`,f.q.Warn),this.store.delete([n])):t[n]=i}return Object.entries(t).sort(([e,{collectionDate:t}],[n,{collectionDate:i}])=>new Date(t).getTime()-new Date(i).getTime())}scanPendingPings(){if(this.observer)for(let[e,t]of this.getAllPingsWithoutSurplus())this.observer.update(e,t)}clearAll(){this.store.delete([])}getAllPingsWithoutSurplus(e=250,t=0xa00000){let n=this.getAllPings(),i=n.filter(([e,t])=>!A(t)).reverse(),r=n.filter(([e,t])=>A(t)),a=i.length;a>e&&(0,f.A)(P,[`More than ${e} pending pings in the pings database,`,`will delete ${a-e} old pings.`],f.q.Warn);let s=!1,o=0,l=0,c=[];for(let[n,r]of i){var d;o++,l+=(d=r,(0,M._u)(JSON.stringify(d)).length),!s&&l>t&&((0,f.A)(P,[`Pending pings database has reached the size quota of ${t} bytes,`,"outstanding pings will be deleted."],f.q.Warn),s=!0),o>e&&(s=!0),s?this.deletePing(n):c.unshift([n,r])}return[...r,...c]}};function A(e){return e.path.split("/")[3]===T.OM}(a=d||(d={}))[a.Incrementing=0]="Incrementing",a[a.Throttled=1]="Throttled";let RateLimiter=class RateLimiter{constructor(e=6e4,t=40,n=0,i){this.interval=e,this.maxCount=t,this.count=n,this.started=i}get elapsed(){if((0,E.b0)(this.started))return NaN;let e=(0,E.bQ)()-this.started;return e<0?NaN:e}reset(){this.started=(0,E.bQ)(),this.count=0}shouldReset(){return!!((0,E.b0)(this.started)||isNaN(this.elapsed)||this.elapsed>this.interval)}getState(){this.shouldReset()&&this.reset();let e=this.interval-this.elapsed;return this.count>=this.maxCount?{state:1,remainingTime:e}:(this.count++,{state:0})}};let Policy=class Policy{constructor(e=3,t=3,n=1048576){this.maxWaitAttempts=e,this.maxRecoverableFailures=t,this.maxPingBodySize=n}};let PingBodyOverflowError=class PingBodyOverflowError extends Error{constructor(e){super(e),this.name="PingBodyOverflow"}};let PingRequest=class PingRequest{constructor(e,t,n,i){this.identifier=e,this.headers=t,this.payload=n,this.maxBodySize=i}asCompressedPayload(){let e;if("gzip"==this.headers["Content-Encoding"])return this;let t=(0,M._u)(this.payload),n=this.headers;try{e=(0,M.u3)(t),n["Content-Encoding"]="gzip",n["Content-Length"]=e.length.toString()}catch(e){return this}if(e.length>this.maxBodySize)throw new PingBodyOverflowError(`Body for ping ${this.identifier} exceeds ${this.maxBodySize} bytes. Discarding.`);return new PingRequest(this.identifier,n,e,this.maxBodySize)}};let $="core.Upload.PingUploadWorker";let PingUploadWorker=class PingUploadWorker{constructor(e,t,n=new Policy){this.uploader=e,this.serverEndpoint=t,this.policy=n,this.isBlocking=!1}buildPingRequest(e){let t=e.headers||{};t={...e.headers,"Content-Type":"application/json; charset=utf-8",Date:new Date().toISOString(),"X-Telemetry-Agent":`Glean/${T.rZ} (JS on ${w.o.platform.info.os()})`};let n=JSON.stringify(e.payload);if(n.length>this.policy.maxPingBodySize)throw new PingBodyOverflowError(`Body for ping ${e.identifier} exceeds ${this.policy.maxPingBodySize}bytes. Discarding.`);return t["Content-Length"]=n.length.toString(),new PingRequest(e.identifier,t,n,this.policy.maxPingBodySize)}async attemptPingUpload(e){try{let t=this.buildPingRequest(e);return this.uploader.post(`${this.serverEndpoint}${e.path}`,t)}catch(e){return(0,f.A)($,["Error trying to build or post ping request:",e],f.q.Warn),new UploadResult(1)}}work(e,t){for(;;)try{let n=e();switch(n.type){case"upload":if(this.isBlocking)return;this.attemptPingUpload(n.ping).then(e=>{t(n.ping,e)}).catch(e=>{console.log(e)});continue;case"done":return}}catch(e){(0,f.A)($,["IMPOSSIBLE: Something went wrong while processing ping upload tasks.",e],f.q.Error)}}blockUploading(){this.isBlocking=!0}resumeUploading(){this.isBlocking=!1}};(s=u||(u={})).Done="done",s.Wait="wait",s.Upload="upload";let C=()=>({type:"done"}),_="core.Upload.PingUploadManager";let PingUploadManager=class PingUploadManager{constructor(e,t,n=new Policy,i=new RateLimiter){this.pingsDatabase=t,this.policy=n,this.rateLimiter=i,this.recoverableFailureCount=0,this.waitAttemptCount=0,this.queue=[],this.processing=new Set,this.worker=new PingUploadWorker(e.httpClient?e.httpClient:w.o.platform.uploader,e.serverEndpoint,n),t.attachObserver(this)}getUploadTask(){let e=this.getUploadTaskInternal();return"wait"!==e.type&&this.waitAttemptCount>0&&(this.waitAttemptCount=0),"upload"!==e.type&&this.recoverableFailureCount>0&&(this.recoverableFailureCount=0),e}processPingUploadResponse(e,t){let{identifier:n}=e;this.processing.has(n)&&this.processing.delete(n);let{status:i,result:r}=t;if(i&&i>=200&&i<300){(0,f.A)(_,`Ping ${n} successfully sent ${i}.`,f.q.Info),this.pingsDatabase.deletePing(n);return}if(1===r||i&&i>=400&&i<500){(0,f.A)(_,`Unrecoverable upload failure while attempting to send ping ${n}. Error was: ${null!=i?i:"no status"}.`,f.q.Warn),this.pingsDatabase.deletePing(n);return}(0,f.A)(_,[`Recoverable upload failure while attempting to send ping ${n}, will retry.`,`Error was: ${null!=i?i:"no status"}.`],f.q.Warn),this.recoverableFailureCount++,this.enqueuePing(e)}clearPendingPingsQueue(){this.queue=this.queue.filter(e=>A(e))}blockUploads(){this.worker.blockUploading()}resumeUploads(){this.worker.resumeUploading()}update(e,t){this.enqueuePing({identifier:e,...t}),this.worker.isBlocking||(this.processing.delete(e),this.pingsDatabase.deletePing(e)),this.worker.work(()=>this.getUploadTask(),(e,t)=>this.processPingUploadResponse(e,t))}enqueuePing(e){if(!this.processing.has(e.identifier)){for(let t of this.queue)if(t.identifier===e.identifier)return;this.queue.push(e)}}getUploadTaskInternal(){if(this.recoverableFailureCount>=this.policy.maxRecoverableFailures)return(0,f.A)(_,"Glean has reached maximum recoverable upload failures for the current uploading window.",f.q.Debug),C();if(this.queue.length>0){let{state:e,remainingTime:t}=this.rateLimiter.getState();if(1===e)return((0,f.A)(_,["Glean is currently throttled.",`Pending pings may be uploaded in ${(t||0)/1e3}s.`],f.q.Debug),this.waitAttemptCount++,this.waitAttemptCount>this.policy.maxWaitAttempts)?C():{type:"wait",remainingTime:t||0};let n=this.queue.shift();return this.processing.add(n.identifier),{type:"upload",ping:n}}return C()}};var U=n(78500),O=n(36633);(o=g||(g={})).Nanosecond="nanosecond",o.Microsecond="microsecond",o.Millisecond="millisecond",o.Second="second",o.Minute="minute",o.Hour="hour",o.Day="day";let q=g;var k=n(46705);let DatetimeMetric=class DatetimeMetric extends k.JW{constructor(e){super(e)}static fromDate(e,t){if(!(e instanceof Date))throw new k.c1(`Expected Date object, got ${JSON.stringify(e)}`);return new DatetimeMetric({timeUnit:t,timezone:e.getTimezoneOffset(),date:e.toISOString()})}get date(){return new Date(this.inner.date)}get timezone(){return this.inner.timezone}get timeUnit(){return this.inner.timeUnit}get dateISOString(){return this.inner.date}validate(e){if(!(0,E.Gv)(e)||3!==Object.keys(e).length)return{type:k.iF.Error,errorMessage:`Expected Glean datetime metric object, got ${JSON.stringify(e)}`};let t="timeUnit"in e&&(0,E.Kg)(e.timeUnit)&&Object.values(q).includes(e.timeUnit),n="timezone"in e&&(0,E.Et)(e.timezone),i="date"in e&&(0,E.Kg)(e.date)&&24===e.date.length&&!isNaN(Date.parse(e.date));return t&&n&&i?{type:k.iF.Success}:{type:k.iF.Error,errorMessage:`Invalid property on datetime metric, got ${JSON.stringify(e)}`}}payload(){let e=this.dateISOString.match(/\d+/g);if(!e||e.length<0)throw Error("IMPOSSIBLE: Unable to extract date information from DatetimeMetric.");let t=new Date(parseInt(e[0]),parseInt(e[1])-1,parseInt(e[2]),parseInt(e[3])-this.timezone/60,parseInt(e[4]),parseInt(e[5]),parseInt(e[6])),n=function(e){let t=-(e/60*1),n=Math.abs(t).toString().padStart(2,"0");return`${t>0?"+":"-"}${n}:00`}(this.timezone),i=t.getFullYear().toString().padStart(2,"0"),r=(t.getMonth()+1).toString().padStart(2,"0"),a=t.getDate().toString().padStart(2,"0");if(this.timeUnit===q.Day)return`${i}-${r}-${a}${n}`;let s=t.getHours().toString().padStart(2,"0");if(this.timeUnit===q.Hour)return`${i}-${r}-${a}T${s}${n}`;let o=t.getMinutes().toString().padStart(2,"0");if(this.timeUnit===q.Minute)return`${i}-${r}-${a}T${s}:${o}${n}`;let l=t.getSeconds().toString().padStart(2,"0");if(this.timeUnit===q.Second)return`${i}-${r}-${a}T${s}:${o}:${l}${n}`;let c=t.getMilliseconds().toString().padStart(3,"0");return this.timeUnit===q.Millisecond?`${i}-${r}-${a}T${s}:${o}:${l}.${c}${n}`:this.timeUnit===q.Microsecond?`${i}-${r}-${a}T${s}:${o}:${l}.${c}000${n}`:`${i}-${r}-${a}T${s}:${o}:${l}.${c}000000${n}`}};let InternalDatetimeMetricType=class InternalDatetimeMetricType extends O.v{constructor(e,t){super("datetime",e,DatetimeMetric),this.timeUnit=t}set(e){if(!this.shouldRecord(w.o.uploadEnabled))return;let t=this.truncateDate(e);try{let e=DatetimeMetric.fromDate(t,this.timeUnit);w.o.metricsDatabase.record(this,e)}catch(e){e instanceof k.c1&&e.recordError(this)}}truncateDate(e){e||(e=new Date);let t=e;switch(this.timeUnit){case q.Day:t.setMilliseconds(0),t.setSeconds(0),t.setMinutes(0),t.setMilliseconds(0);case q.Hour:t.setMilliseconds(0),t.setSeconds(0),t.setMinutes(0);case q.Minute:t.setMilliseconds(0),t.setSeconds(0);case q.Second:t.setMilliseconds(0)}return t}testGetValueAsDatetimeMetric(e,t){if((0,E.xU)(t,"core.metrics.DatetimeMetricType")){let t=w.o.metricsDatabase.getMetric(e,this);if(t)return new DatetimeMetric(t)}}testGetValueAsString(e=this.sendInPings[0]){let t=this.testGetValueAsDatetimeMetric(e,"testGetValueAsString");return t?t.payload():void 0}testGetValue(e=this.sendInPings[0]){let t=this.testGetValueAsDatetimeMetric(e,"testGetValue");return t?t.date:void 0}};new WeakMap;var z=n(93716);let StringMetric=class StringMetric extends k.JW{constructor(e){super(e)}validate(e){return(0,z.oI)(e)}payload(){return this.inner}};let InternalStringMetricType=class InternalStringMetricType extends O.v{constructor(e){super("string",e,StringMetric)}set(e){if(this.shouldRecord(w.o.uploadEnabled))try{let t=(0,E.Wl)(this,e,100),n=new StringMetric(t);w.o.metricsDatabase.record(this,n)}catch(e){e instanceof k.c1&&e.recordError(this)}}testGetValue(e=this.sendInPings[0]){if((0,E.xU)("testGetValue","core.metrics.StringMetricType"))return w.o.metricsDatabase.getMetric(e,this)}};new WeakMap;let B="core.metrics.CounterMetricType";let CounterMetric=class CounterMetric extends k.JW{constructor(e){super(e)}validate(e){return(0,z.wQ)(e,!1)}payload(){return this.inner}saturatingAdd(e){let t=this.validateOrThrow(e);this.inner=(0,E.cE)(this.inner,t)}};let InternalCounterMetricType=class InternalCounterMetricType extends O.v{constructor(e){super("counter",e,CounterMetric)}add(e){if(this.shouldRecord(w.o.uploadEnabled)){(0,E.b0)(e)&&(e=1);try{w.o.metricsDatabase.transform(this,this.transformFn(e))}catch(e){e instanceof k.c1&&e.recordError(this)}}}transformFn(e){return t=>{let n=new CounterMetric(e);if(t)try{n.saturatingAdd(t)}catch(e){(0,f.A)(B,`Unexpected value found in storage for metric ${this.name}: ${JSON.stringify(t)}. Overwriting.`)}return n}}testGetValue(e=this.sendInPings[0]){if((0,E.xU)("testGetValue",B))return w.o.metricsDatabase.getMetric(e,this)}};new WeakMap;let CoreMetrics=class CoreMetrics{constructor(){this.clientId=new U.Pc({name:"client_id",category:"",sendInPings:["glean_client_info"],lifetime:"user",disabled:!1}),this.firstRunDate=new InternalDatetimeMetricType({name:"first_run_date",category:"",sendInPings:["glean_client_info"],lifetime:"user",disabled:!1},q.Day),this.os=new InternalStringMetricType({name:"os",category:"",sendInPings:["glean_client_info"],lifetime:"application",disabled:!1}),this.osVersion=new InternalStringMetricType({name:"os_version",category:"",sendInPings:["glean_client_info"],lifetime:"application",disabled:!1}),this.architecture=new InternalStringMetricType({name:"architecture",category:"",sendInPings:["glean_client_info"],lifetime:"application",disabled:!1}),this.locale=new InternalStringMetricType({name:"locale",category:"",sendInPings:["glean_client_info"],lifetime:"application",disabled:!1}),this.appChannel=new InternalStringMetricType({name:"app_channel",category:"",sendInPings:["glean_client_info"],lifetime:"application",disabled:!1}),this.appBuild=new InternalStringMetricType({name:"app_build",category:"",sendInPings:["glean_client_info"],lifetime:"application",disabled:!1}),this.appDisplayVersion=new InternalStringMetricType({name:"app_display_version",category:"",sendInPings:["glean_client_info"],lifetime:"application",disabled:!1}),this.buildDate=new InternalDatetimeMetricType({name:"build_date",category:"",sendInPings:["glean_client_info"],lifetime:"application",disabled:!1},"second"),this.sessionId=new U.Pc({name:"session_id",category:"",sendInPings:["glean_client_info"],lifetime:"user",disabled:!1}),this.sessionCount=new InternalCounterMetricType({name:"session_count",category:"",sendInPings:["glean_client_info"],lifetime:"user",disabled:!1})}initialize(){!(!w.o.testing&&(0,E.IB)())&&(this.initializeClientId(),this.initializeFirstRunDate(),this.updateSessionInfo(),this.os.set(w.o.platform.info.os()),this.osVersion.set(w.o.platform.info.osVersion()),this.architecture.set(w.o.platform.info.arch()),this.locale.set(w.o.platform.info.locale()),this.appBuild.set(w.o.config.appBuild||"Unknown"),this.appDisplayVersion.set(w.o.config.appDisplayVersion||"Unknown"),w.o.config.channel&&this.appChannel.set(w.o.config.channel),w.o.config.buildDate&&this.buildDate.set())}updateSessionInfo(){if(!(0,E.IB)()){if(w.o.metricsDatabase.getMetric(T.Tv,this.sessionId))try{(function(e=30){let t=null;try{t=localStorage.getItem("glean_session_last_active")}catch(e){console.warn(e)}let n=new Date(Number(t)),i=new Date;return i.setMinutes(i.getMinutes()-e),i>n})(w.o.config.sessionLengthInMinutesOverride)&&this.generateNewSession()}catch(e){this.generateNewSession()}else this.generateNewSession();try{localStorage.setItem("glean_session_last_active",Date.now().toString())}catch(e){console.warn(e)}}}initializeClientId(){let e=!1,t=w.o.metricsDatabase.getMetric(T.Tv,this.clientId);if(t)try{(0,z.Hp)("uuid",t).payload()===T.Kp&&(e=!0)}catch(t){(0,f.A)("core.InternalMetrics","Unexpected value found for Glean clientId. Ignoring.",f.q.Warn),e=!0}else e=!0;e&&this.clientId.set((0,E.Z3)())}initializeFirstRunDate(){w.o.metricsDatabase.getMetric(T.Tv,this.firstRunDate)||this.firstRunDate.set()}generateNewSession(){this.sessionId.generateAndSet(),this.sessionCount.add()}};let L="core.Pings.Maker",G=function(e,t,n){let i=function(e,t){let n=w.o.eventsDatabase.getPingEvents(e.name,!0),i=w.o.metricsDatabase.getPingMetrics(e.name,!0);if(!i&&!n){if(!e.sendIfEmpty)return void(0,f.A)(L,`Storage for ${e.name} empty. Bailing out.`,f.q.Info);(0,f.A)(L,`Storage for ${e.name} empty. Ping will still be sent.`,f.q.Info)}e.includeClientId&&w.o.config.experimentationId&&(i=void 0!==i?{...i,string:{...(null==i?void 0:i.string)||void 0,"glean.client.annotation.experimentation_id":w.o.config.experimentationId}}:{string:{"glean.client.annotation.experimentation_id":w.o.config.experimentationId}});let r=i?{metrics:i}:{},a=function(e,t){let n=function(e){let t=new InternalCounterMetricType({category:"",name:`${e.name}#sequence`,sendInPings:[T.cp],lifetime:"user",disabled:!1}),n=w.o.metricsDatabase.getMetric(T.cp,t);if(t.add(1),n)try{return new CounterMetric(n).payload()}catch(t){(0,f.A)(L,`Unexpected value found for sequence number in ping ${e.name}. Ignoring.`,f.q.Warn)}return 0}(e),{startTime:i,endTime:r}=function(e){let{startTimeMetric:t,startTime:n}=function(e){let t=new InternalDatetimeMetricType({category:"",name:`${e.name}#start`,sendInPings:[T.cp],lifetime:"user",disabled:!1},q.Minute),n=w.o.metricsDatabase.getMetric(T.cp,t);return{startTimeMetric:t,startTime:n?new DatetimeMetric(n):DatetimeMetric.fromDate(w.o.startTime,q.Minute)}}(e),i=new Date;t.set(i);let r=DatetimeMetric.fromDate(i,q.Minute);return{startTime:n.payload(),endTime:r.payload()}}(e),a={seq:n,start_time:i,end_time:r};return t&&(a.reason=t),a}(e,t),s=function(e){let t=w.o.metricsDatabase.getPingMetrics(T.Tv,!0);t||((0,f.A)(L,"Empty client info data. Will submit anyways.",f.q.Warn),t={});let n={telemetry_sdk_build:T.rZ};for(let e in t)n={...n,...t[e]};return e.includeClientId||(delete n.client_id,delete n.session_id),n}(e);return{...r,...n?{events:n}:{},ping_info:a,client_info:s}}(t,n);if(!i)return;w.o.config.logPings&&(0,f.A)(L,JSON.stringify(i,null,2),f.q.Info);let r=function(){let e={};if(w.o.config.debugViewTag&&(e["X-Debug-ID"]=w.o.config.debugViewTag),w.o.config.sourceTags&&(e["X-Source-Tags"]=w.o.config.sourceTags.toString()),Object.keys(e).length>0)return e}();w.o.pingsDatabase.recordPing(`/submit/${w.o.applicationId}/${t.name}/${T.Tq}/${e}`,e,i,r)},V="core.Pings.PingType";let InternalPingType=class InternalPingType{constructor(e){var t;this.name=e.name,this.includeClientId=e.includeClientId,this.sendIfEmpty=e.sendIfEmpty,this.reasonCodes=null!=(t=e.reasonCodes)?t:[],this.preciseTimestamps=e.preciseTimestamps}submit(e){this.testCallback?this.testCallback(e).then(()=>{this.internalSubmit(e,this.resolveTestPromiseFunction)}).catch(t=>{(0,f.A)(V,[`There was an error validating "${this.name}" (${null!=e?e:"no reason"}):`,t],f.q.Error),this.internalSubmit(e,this.rejectTestPromiseFunction)}):this.internalSubmit(e)}internalSubmit(e,t){if(!w.o.initialized)return void(0,f.A)(V,"Glean must be initialized before submitting pings.",f.q.Info);if(!w.o.uploadEnabled&&this.name!==T.OM)return void(0,f.A)(V,"Glean disabled: not submitting pings. Glean may still submit the deletion-request ping.",f.q.Info);let n=e;e&&!this.reasonCodes.includes(e)&&((0,f.A)(V,`Invalid reason code ${e} from ${this.name}. Ignoring.`,f.q.Warn),n=void 0),G((0,E.Z3)(),this,n),t&&(t(),this.resolveTestPromiseFunction=void 0,this.rejectTestPromiseFunction=void 0,this.testCallback=void 0)}async testBeforeNextSubmit(e){if((0,E.xU)("testBeforeNextSubmit",V))return this.testCallback?void(0,f.A)(V,`There is an existing test call for ping "${this.name}". Ignoring.`,f.q.Error):new Promise((t,n)=>{this.resolveTestPromiseFunction=t,this.rejectTestPromiseFunction=n,this.testCallback=e})}};new WeakMap;let CorePings=class CorePings{constructor(){this.deletionRequest=new InternalPingType({name:T.OM,includeClientId:!0,sendIfEmpty:!0,reasonCodes:["at_init","set_upload_enabled"]}),this.events=new InternalPingType({name:T.T$,includeClientId:!0,sendIfEmpty:!1,reasonCodes:["startup","max_capacity"]})}};let N="core.Metrics.Database",R="reserved#",F=`glean.${R}`;let MetricsDatabase=class MetricsDatabase{constructor(){this.userStore=new w.o.platform.Storage("userLifetimeMetrics"),this.pingStore=new w.o.platform.Storage("pingLifetimeMetrics"),this.appStore=new w.o.platform.Storage("appLifetimeMetrics")}record(e,t){this.transform(e,()=>t)}transform(e,t){if(e.disabled)return;let n=this.chooseStore(e.lifetime),i=e.identifier();for(let r of e.sendInPings){let a=e=>t(e).get();n.update([r,e.type,i],a)}}hasMetric(e,t,n,i){let r=this.chooseStore(e).get([t,n,i]);return!(0,E.b0)(r)}countByBaseIdentifier(e,t,n,i){let r=this.chooseStore(e).get([t,n]);return(0,E.b0)(r)?0:Object.keys(r).filter(e=>e.startsWith(i)).length}getMetric(e,t){let n=this.chooseStore(t.lifetime),i=t.identifier(),r=n.get([e,t.type,i]);if((0,E.b0)(r)||(0,z.LE)(t.type,r))return r;(0,f.A)(N,`Unexpected value found for metric ${i}: ${JSON.stringify(r)}. Clearing.`,f.q.Error),n.delete([e,t.type,i])}getPingMetrics(e,t){let n=this.getCorrectedPingData(e,"user"),i=this.getCorrectedPingData(e,"ping"),r=this.getCorrectedPingData(e,"application");t&&Object.keys(i).length>0&&this.clear("ping",e);let a={};for(let e of[n,i,r])for(let t in e)for(let n in e[t])n.startsWith(F)||(n.includes("/")?this.processLabeledMetric(a,t,n,e[t][n]):a[t]={...a[t],[n]:e[t][n]});if(0!==Object.keys(a).length){let e={};for(let t in a){let n=a[t];for(let i in e[t]={},n){let r=(0,z.Hp)(t,n[i]);e[t][i]=r.payload()}}return e}}clear(e,t){this.chooseStore(e).delete(t?[t]:[])}clearAll(){this.userStore.delete([]),this.pingStore.delete([]),this.appStore.delete([])}chooseStore(e){switch(e){case"user":return this.userStore;case"ping":return this.pingStore;case"application":return this.appStore}}getCorrectedPingData(e,t){let n=this.chooseStore(t),i=n.get([e]);if((0,E.b0)(i))return{};if(!(0,E.Gv)(i))return(0,f.A)(N,`Invalid value found in storage for ping "${e}". Deleting.`,f.q.Debug),n.delete([e]),{};let r={};for(let t in i){let a=i[t];if(!(0,E.Gv)(a)){(0,f.A)(N,`Unexpected data found in storage for metrics of type "${t}" in ping "${e}". Deleting.`,f.q.Debug),n.delete([e,t]);continue}for(let i in a){if(!(0,z.LE)(t,a[i])){(0,f.A)(N,`Invalid value "${JSON.stringify(a[i])}" found in storage for metric "${i}". Deleting.`,f.q.Debug),n.delete([e,t,i]);continue}r[t]||(r[t]={}),r[t][i]=a[i]}}return r}processLabeledMetric(e,t,n,i){let r=`labeled_${t}`,a=n.split("/",2),s=a[0],o=a[1];if(r in e&&s in e[r]){let t=e[r][s];e[r][s]={...t,[o]:i}}else e[r]={...e[r],[s]:{[o]:i}}}};var W=n(49175),j=n(79187),J=n(58574);let K="core.Metric.EventsDatabase";function H(e,t=w.o.startTime){Q(e).record({[T.zh]:t.toISOString()},0)}function X(e){(0,E.Kg)(e)||(e="");let t=new Date(e);if(isNaN(t.getTime()))throw Error(`Error attempting to generate Date object from string: ${e}`);return t}function Z(e){return new InternalCounterMetricType({...{category:"glean",name:`${R}execution_counter`},sendInPings:e.filter(e=>e!==T.T$),lifetime:"ping",disabled:!1})}function Q(e){return new j.C({category:"glean",name:"restarted",sendInPings:e.filter(e=>e!==T.T$),lifetime:"ping",disabled:!1},[T.zh])}let EventsDatabase=class EventsDatabase{constructor(){this.initialized=!1,this.eventsStore=new w.o.platform.Storage("events")}initialize(){var e;if(this.initialized)return;let t=this.getAvailableStoreNames();if(t.includes(T.T$)){let t=null!=(e=this.eventsStore.get([T.T$]))?e:[];t.length>0&&t.length>=w.o.config.maxEvents&&w.o.corePings.events.submit("startup")}Z(t).add(1),H(t),this.initialized=!0}record(e,t){if(!e.disabled)for(let n of e.sendInPings){let e=Z([n]),i=w.o.metricsDatabase.getMetric(n,e);i||(e.add(1),i=1,H([n],new Date)),t.addExtra(T.HT,i);let r=0,a=e=>{let n=null!=e?e:[];return n.push(t.get()),r=n.length,n};this.eventsStore.update([n],a),n===T.T$&&r>=w.o.config.maxEvents&&w.o.corePings.events.submit("max_capacity")}}getEvents(e,t){let n=this.getAndValidatePingData(e);if(0!==n.length)return n.filter(e=>e.get().category===t.category&&e.get().name===t.name).map(e=>e.withoutReservedExtras())}getPingEvents(e,t){let n=this.getAndValidatePingData(e);if(t&&Object.keys(n).length>0&&this.eventsStore.delete([e]),0===n.length)return;let i=this.prepareEventsPayload(e,n);if(i.length>0)return i}clearAll(){this.eventsStore.delete([])}getAvailableStoreNames(){let e=this.eventsStore.get([]);return(0,E.b0)(e)?[]:Object.keys(e)}getAndValidatePingData(e){let t=this.eventsStore.get([e]);return(0,E.b0)(t)?[]:Array.isArray(t)?t.reduce((e,t)=>{try{let n=new J.j(t);return[...e,n]}catch(n){return(0,f.A)(K,`Unexpected data found in events storage: ${JSON.stringify(t)}. Ignoring.`),e}},[]):((0,f.A)(K,`Unexpected value found for ping ${e}: ${JSON.stringify(t)}. Clearing.`,f.q.Error),this.eventsStore.delete([e]),[])}prepareEventsPayload(e,t){var n,i,r,a;let s,o=t.sort((e,t)=>{var n,i;let r=Number(null==(n=e.get().extra)?void 0:n[T.HT]),a=Number(null==(i=t.get().extra)?void 0:i[T.HT]);return r!==a?r-a:e.get().timestamp-t.get().timestamp});try{s=X(null==(n=o[0].get().extra)?void 0:n[T.zh]),o.shift()}catch(e){s=w.o.startTime}let l=(null==(i=o[0])?void 0:i.get().timestamp)||0,c=0;for(let[t,n]of o.entries()){let i;try{let i=X(null==(r=n.get().extra)?void 0:r[T.zh]),a=i.getTime()-s.getTime();s=i;let l=c+a,d=o[t-1].get().timestamp;l<=d?(c=d+1,w.o.errorManager.record(Q([e]),W.B.InvalidValue,`Invalid time offset between application sessions found for ping "${e}". Ignoring.`)):c=l}catch(e){}i=1===Number((null==(a=n.get().extra)?void 0:a[T.HT])||1)?n.get().timestamp-l:n.get().timestamp+c,o[t]=new J.j({category:n.get().category,name:n.get().name,timestamp:i,extra:n.get().extra})}return(o=function(e){for(var t,n,i;e.length&&(null==(i=null==(n=null==(t=e[e.length-1])?void 0:t.get())?void 0:n.extra)?void 0:i[T.zh]);)e.pop();return e}(o)).map(e=>e.payload())}};var Y=n(30040);function ee(e,t){let n=e.baseIdentifier(),i=(0,Y.X3)(n);return new InternalCounterMetricType({name:(0,Y.Uh)(t,i),category:"glean.error",lifetime:"ping",sendInPings:e.sendInPings,disabled:!1})}let ErrorManager=class ErrorManager{record(e,t,n,i=1){let r=ee(e,t);(0,f.A)(function(e){let t=e.type.charAt(0).toUpperCase()+e.type.slice(1);return`core.metrics.${t}`}(e),[`${e.baseIdentifier()}:`,n]),i>0&&r.add(i)}testGetNumRecordedErrors(e,t,n){return ee(e,t).testGetValue(n)||0}};var et=n(92);let en="core.Glean";(l=p||(p={})).DebugTag="DebugTag",l.SourceTags="SourceTags",l.LogPings="LogPings";let ei=(e,t)=>{let n=`Glean.${e.toString()}`;try{switch(e){case p.DebugTag:sessionStorage.setItem(n,t);break;case p.LogPings:sessionStorage.setItem(n,t.toString());break;case p.SourceTags:sessionStorage.setItem(n,t.join(","))}}catch(e){console.warn(e)}},er=e=>{try{return sessionStorage.getItem(`Glean.${e.toString()}`)||void 0}catch(e){console.warn(e);return}};!function(e){function t(){w.o.uploadEnabled=!0,e.pingUploader.resumeUploads()}function n(e){w.o.uploadEnabled=!1,w.o.corePings.deletionRequest.submit(e?"at_init":"set_upload_enabled"),i()}function i(){let t;e.pingUploader.clearPendingPingsQueue();try{t=new DatetimeMetric(w.o.metricsDatabase.getMetric(T.Tv,w.o.coreMetrics.firstRunDate)).date}catch(e){t=new Date}w.o.eventsDatabase.clearAll(),w.o.metricsDatabase.clearAll(),w.o.pingsDatabase.clearAll(),w.o.uploadEnabled=!0,w.o.coreMetrics.clientId.set(T.Kp),w.o.coreMetrics.firstRunDate.set(t),w.o.uploadEnabled=!1}e.initialize=function(r,a,s){if(w.o.initialized)return void(0,f.A)(en,"Attempted to initialize Glean, but it has already been initialized. Ignoring.",f.q.Warn);if(!(0,E.Kg)(r))return void(0,f.A)(en,"Unable to initialize Glean, applicationId must be a string.",f.q.Error);if(!(0,E.Lm)(a))return void(0,f.A)(en,"Unable to initialize Glean, uploadEnabled must be a boolean.",f.q.Error);if(0===r.length)return void(0,f.A)(en,"Unable to initialize Glean, applicationId cannot be an empty string.",f.q.Error);if(!w.o.platform)return void(0,f.A)(en,"Unable to initialize Glean, platform has not been set.",f.q.Error);if(w.o.coreMetrics=new CoreMetrics,w.o.corePings=new CorePings,w.o.applicationId=(0,E.zn)(r),w.o.config=new Configuration(s),!function(){if("undefined"==typeof window||void 0===window.sessionStorage)return;let t=er(p.LogPings);t&&(e.preInitLogPings=(0,E.PK)(t));let n=er(p.DebugTag);n&&(e.preInitDebugViewTag=n);let i=er(p.SourceTags);i&&(e.preInitSourceTags=i.split(","))}(),e.preInitLogPings&&(w.o.config.logPings=e.preInitLogPings),e.preInitDebugViewTag&&(w.o.config.debugViewTag=e.preInitDebugViewTag),e.preInitSourceTags&&(w.o.config.sourceTags=e.preInitSourceTags),w.o.metricsDatabase=new MetricsDatabase,w.o.eventsDatabase=new EventsDatabase,w.o.pingsDatabase=new PingsDatabase,w.o.errorManager=new ErrorManager,e.pingUploader=new PingUploadManager(w.o.config,w.o.pingsDatabase),w.o.initialized=!0,w.o.uploadEnabled=a,w.o.eventsDatabase.initialize(),a)w.o.metricsDatabase.clear("application"),t(),w.o.coreMetrics.initialize(),(null==s?void 0:s.enableAutoPageLoadEvents)&&et.A.pageLoad(),(null==s?void 0:s.enableAutoElementClickEvents)&&document.addEventListener("click",e=>{et.A.handleClickEvent(e)});else{let e=w.o.metricsDatabase.getMetric(T.Tv,w.o.coreMetrics.clientId);e?e!==T.Kp&&n(!0):i()}w.o.pingsDatabase.scanPendingPings()},e.setUploadEnabled=function(e){return w.o.initialized?(0,E.Lm)(e)?void(w.o.uploadEnabled!==e&&(e?(t(),w.o.coreMetrics.initialize()):n(!1))):void(0,f.A)(en,"Unable to change upload state, new value must be a boolean. Ignoring.",f.q.Error):void(0,f.A)(en,["Changing upload enabled before Glean is initialized is not supported.\n","Pass the correct state into `initialize`.\n","See documentation at https://mozilla.github.io/glean/book/user/general-api.html#initializing-the-glean-sdk`"],f.q.Error)},e.setExperimentationId=function(e){w.o.config.experimentationId=e},e.setLogPings=function(t){w.o.initialized?w.o.config.logPings=t:e.preInitLogPings=t},e.setDebugViewTag=function(t){w.o.initialized?w.o.config.debugViewTag=t:e.preInitDebugViewTag=t},e.setSourceTags=function(t){w.o.initialized?w.o.config.sourceTags=t:e.preInitSourceTags=t},e.setPlatform=function(e){w.o.initialized||(w.o.isPlatformSet()&&w.o.platform.name!==e.name&&!w.o.testing&&(0,f.A)(en,[`IMPOSSIBLE: Attempted to change Glean's targeted platform",
            "from "${w.o.platform.name}" to "${e.name}". Ignoring.`],f.q.Error),w.o.platform=e)}}(h||(h={}));let ea=!1;try{ea="undefined"!=typeof window&&void 0!==window.sessionStorage}catch(e){console.error("No session storage available",e)}ea&&(window.Glean={setLogPings:e=>{ei(p.LogPings,e),h.setLogPings(e),console.log("Pings will be logged to the console until this tab is closed.")},setDebugViewTag:e=>{ei(p.DebugTag,e),h.setDebugViewTag(e),console.log("Pings will be sent to the Debug Ping Viewer until this tab is closed. Pings can be found here: https://debug-ping-preview.firebaseapp.com/.")},setSourceTags:e=>{ei(p.SourceTags,e),h.setSourceTags(e),console.log("Pings will be given the specified tags until the tab is closed.")},debugSession:()=>{let e=w.o.metricsDatabase.getMetric(T.Tv,w.o.coreMetrics.sessionId);e&&"string"==typeof e&&w.o.config.debugViewTag?window.open(`https://debug-ping-preview.firebaseapp.com/stream/${w.o.config.debugViewTag}#${e}`,"_blank"):console.info("You must set a debug tag via `window.Glean.setDebugViewTag` before debugging your session.")}});let es=h,eo=(i={Storage:WebStore,uploader:I,info:{os(){let e;return(e=navigator&&navigator.userAgent?navigator.userAgent:"Unknown").includes("Windows")?"Windows":/tvOS/i.test(e)?"TvOS":/Watch( OS)?/i.test(e)?"WatchOS":/iPhone|iPad|iOS/i.test(e)?"iOS":/Mac OS X|macOS/i.test(e)?"Darwin":/Android/i.test(e)?"Android":/CrOS/i.test(e)?"ChromeOS":/WebOS/i.test(e)?"WebOS":/Linux/i.test(e)?"Linux":/OpenBSD/i.test(e)?"OpenBSD":/FreeBSD/i.test(e)?"FreeBSD":/NetBSD/i.test(e)?"NetBSD":/SunOS/i.test(e)?"SunOS":/AIX/i.test(e)?"IBM_AIX":"Unknown"},osVersion:()=>"Unknown",arch:()=>"Unknown",locale:()=>navigator&&navigator.language?navigator.language:"und"},timer:{setTimeout,clearTimeout},name:"web"},{initialize(e,t,n){es.setPlatform(i),es.initialize(e,t,n)},setUploadEnabled(e){es.setUploadEnabled(e)},setLogPings(e){es.setLogPings(e)},setDebugViewTag(e){es.setDebugViewTag(e)},setSourceTags(e){es.setSourceTags(e)}})}};
//# sourceMappingURL=1127.f5563db9beba3133.js.map